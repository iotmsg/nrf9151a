<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Cliente MQTT Web</title>
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
</head>
<body>
  <h2>Estado MQTT: <span id="status">Conectando...</span></h2>
  <button id="sendBtn">Enviar mensaje</button>
  <pre id="output"></pre>

  <script>
    const subscribeTopic = "topicsub";
    const publishTopic = "topicpub";

    const client = mqtt.connect("wss://broker.emqx.io:8084/mqtt", {
      clientId: "web_" + Math.random().toString(16).substr(2, 8)
    });

    const statusEl = document.getElementById("status");
    const outputEl = document.getElementById("output");
    const sendBtn = document.getElementById("sendBtn");

    client.on("connect", () => {
      statusEl.textContent = "Conectado";
      client.subscribe(subscribeTopic);
    });

    client.on("message", (topic, message) => {
      const timestamp = new Date().toLocaleTimeString();
      outputEl.textContent = `[${timestamp}] Tópico: ${topic}\n${message.toString()}`;
    });

    client.on("error", (err) => {
      statusEl.textContent = "Error de conexión";
      console.error("MQTT Error:", err);
    });

    sendBtn.addEventListener("click", () => {
      const payload = {
        mensaje: "Hola desde el cliente web",
        timestamp: new Date().toISOString()
      };
      client.publish(publishTopic, JSON.stringify(payload));
    });
  </script>
</body>
</html>
